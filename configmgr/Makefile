CFLAGS = -fPIC -Wall -Wextra -Wunused

# GCC automatically takes CPATH and C_INCLUDE_PATH environment variables
# so only need to handle any additional paths that user wants to pass to make
# in EXTRA_C_INCLUDE_PATHS (whitespace-separated)
INCLUDEDIRS=$(foreach p,$(EXTRA_C_INCLUDE_PATHS),-I$p)

CROSS_COMPILE =
CC = $(CROSS_COMPILE)gcc

LDFLAGS += -shared
RM = rm -f

LOCAL_INCLUDE_PATH = ../include

LIB=libaudiohalcm.so
SRC=audio_config.c
OBJ=${SRC:.c=.o}
DEP=${SRC:.c=.d}


.PHONY: all build clean
all: build

%.d: %.c
	${CC} ${INCLUDEDIRS} -I${LOCAL_INCLUDE_PATH} ${CFLAGS} -M -o $@ $<

# Pull in all .c file dependencies generated by rule above
-include ${DEP}

build: ${LIB}

${LIB}: ${OBJ}
	${CC} ${LDFLAGS} $^ -o $@  -lexpat -ltinyalsa

%.o: %.c
	${CC} ${INCLUDEDIRS} -I${LOCAL_INCLUDE_PATH} ${CFLAGS} -c -o $@ $<

clean:
	-${RM} ${LIB} ${OBJ} ${DEP}
